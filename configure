#!/bin/sh
# usage: configure gappath
# this script creates a `Makefile' from `Makefile.in'

set -e

error_msg_and_quit() {
    echo "$1"
    echo
    echo "Usage: ./configure [GAPPATH] [--with-pari=PARIPATH]"
    echo
    echo " where"
    echo "  - GAPPATH is a path to your GAP installation"
    echo "    (The default for GAPPATH is \"../..\")"
    echo
    echo "  - PARIPATH is a path to you PARI/GP installation"
    echo "    (By default the configure script assumes that the"
    echo "        compiler will find out itself the location)"
    echo
    echo "Aborting... No Makefile is generated."
    echo
    exit 1
}

GAPPATH=../..
PARIPATH=
while test "$#" -ge 1 ; do
  option="$1" ; shift
  case "$option" in
    --with-gaproot=*) GAPPATH=${option#--with-gaproot=}; ;;
    --with-pari=*)    PARIPATH=${option#--with-pari=}; ;;
    -*)               echo "ERROR: unsupported argument $option" ; exit 1;;
    *)                GAPPATH="$option" ;;
  esac
done

if test ! -r "$GAPPATH/sysinfo.gap" ; then
    error_msg_and_quit "No file $GAPPATH/sysinfo.gap found."
fi

if test -n "$PARIPATH" && test "$PARIPATH" != "builtin"; then
    if test ! -r "$PARIPATH/include/pari/pari.h"; then
        error_msg_and_quit "$2 does not look like a proper pari installtion tree"
    fi
fi

echo "Using settings from $GAPPATH/sysinfo.gap"
sed \
    -e "s;@GAPPATH@;$GAPPATH;" \
    -e "s;@PARIPATH@;$PARIPATH;" \
    Makefile.in > Makefile
